<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>CrÃ³nicas del Reino Olvidado</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/audio-panel.css">
</head>
<body>

<!-- PANTALLA DE CARGA -->
<div id="loading-screen">
    <div class="loading-content">
        <div class="rune-circle"><div class="rune">âš”</div></div>
        <h1 class="game-title">CrÃ³nicas del<br><span>Reino Olvidado</span></h1>
        <div class="loading-bar"><div class="loading-fill"></div></div>
        <p class="loading-text">Despertando el reino...</p>
    </div>
</div>

<!-- MENÃš PRINCIPAL -->
<div id="main-menu" class="hidden">
    <div class="menu-bg">
        <div class="particles" id="particles"></div>
        <div class="menu-overlay"></div>
    </div>
    <div class="menu-content">
        <div class="title-block">
            <div class="crown-icon">â™›</div>
            <h1 class="main-title">CrÃ³nicas del<br><span>Reino Olvidado</span></h1>
            <p class="subtitle">Un mundo de magia, honor y peligro te aguarda</p>
        </div>
        <div class="menu-buttons">
            <button class="btn-menu btn-primary" onclick="AUDIO.select(); showScreen('character-select')">
                <span class="btn-icon">âš”</span> Nueva Partida
            </button>
            <button class="btn-menu btn-secondary" onclick="AUDIO.click(); loadGame()" id="btn-continue">
                <span class="btn-icon">ğŸ“œ</span> Continuar
            </button>
            <button class="btn-menu btn-tertiary" onclick="AUDIO.click(); showScreen('credits')">
                <span class="btn-icon">âœ¦</span> CrÃ©ditos
            </button>
        </div>
    </div>
</div>

<!-- SELECCIÃ“N DE PERSONAJE -->
<div id="character-select" class="hidden screen-dark">
    <div class="screen-header">
        <button class="btn-back" onclick="AUDIO.click(); showScreen('main-menu')">â† Volver</button>
        <h2 class="screen-title">Elige tu Destino</h2>
        <p class="screen-sub">Cada camino conduce a glorias distintas</p>
    </div>
    <div class="name-input-row">
        <label>Nombre del HÃ©roe:</label>
        <input type="text" id="hero-name" placeholder="Escribe tu nombre..." maxlength="20" autocomplete="off">
    </div>
    <div class="classes-grid">
        <div class="class-card" onclick="AUDIO.select(); selectClass('guerrero')" data-class="guerrero">
            <div class="class-art">ğŸ›¡ï¸</div><div class="class-glow guerrero-glow"></div>
            <h3>Guerrero</h3><p class="class-desc">Maestro del combate cuerpo a cuerpo. Alta defensa y fuerza devastadora.</p>
            <div class="class-stats">
                <div class="stat-bar"><span>VID</span><div class="bar"><div style="width:92%" class="bar-hp"></div></div></div>
                <div class="stat-bar"><span>FUE</span><div class="bar"><div style="width:88%" class="bar-str"></div></div></div>
                <div class="stat-bar"><span>MAG</span><div class="bar"><div style="width:15%" class="bar-mag"></div></div></div>
                <div class="stat-bar"><span>AGI</span><div class="bar"><div style="width:45%" class="bar-agi"></div></div></div>
            </div>
            <div class="class-skills"><span>Golpe Brutal</span><span>Escudo FÃ©rreo</span><span>Torbellino</span></div>
        </div>
        <div class="class-card" onclick="AUDIO.select(); selectClass('mago')" data-class="mago">
            <div class="class-art">ğŸ”®</div><div class="class-glow mago-glow"></div>
            <h3>Mago</h3><p class="class-desc">Domina los arcanos secretos. Magia poderosa pero cuerpo frÃ¡gil.</p>
            <div class="class-stats">
                <div class="stat-bar"><span>VID</span><div class="bar"><div style="width:40%" class="bar-hp"></div></div></div>
                <div class="stat-bar"><span>FUE</span><div class="bar"><div style="width:20%" class="bar-str"></div></div></div>
                <div class="stat-bar"><span>MAG</span><div class="bar"><div style="width:98%" class="bar-mag"></div></div></div>
                <div class="stat-bar"><span>AGI</span><div class="bar"><div style="width:60%" class="bar-agi"></div></div></div>
            </div>
            <div class="class-skills"><span>Bola de Fuego</span><span>Tormenta MÃ¡gica</span><span>Meteoro</span></div>
        </div>
        <div class="class-card" onclick="AUDIO.select(); selectClass('arquero')" data-class="arquero">
            <div class="class-art">ğŸ¹</div><div class="class-glow arquero-glow"></div>
            <h3>Arquero</h3><p class="class-desc">Velocidad y precisiÃ³n mortal. Ataca antes que el enemigo reaccione.</p>
            <div class="class-stats">
                <div class="stat-bar"><span>VID</span><div class="bar"><div style="width:58%" class="bar-hp"></div></div></div>
                <div class="stat-bar"><span>FUE</span><div class="bar"><div style="width:68%" class="bar-str"></div></div></div>
                <div class="stat-bar"><span>MAG</span><div class="bar"><div style="width:28%" class="bar-mag"></div></div></div>
                <div class="stat-bar"><span>AGI</span><div class="bar"><div style="width:98%" class="bar-agi"></div></div></div>
            </div>
            <div class="class-skills"><span>Flecha Certera</span><span>Tiro CrÃ­tico</span><span>Flecha Envenenada</span></div>
        </div>
        <div class="class-card" onclick="AUDIO.select(); selectClass('paladin')" data-class="paladin">
            <div class="class-art">âœ¨</div><div class="class-glow paladin-glow"></div>
            <h3>PaladÃ­n</h3><p class="class-desc">Guerrero sagrado. Une fuerza divina con poder de curaciÃ³n.</p>
            <div class="class-stats">
                <div class="stat-bar"><span>VID</span><div class="bar"><div style="width:82%" class="bar-hp"></div></div></div>
                <div class="stat-bar"><span>FUE</span><div class="bar"><div style="width:66%" class="bar-str"></div></div></div>
                <div class="stat-bar"><span>MAG</span><div class="bar"><div style="width:66%" class="bar-mag"></div></div></div>
                <div class="stat-bar"><span>AGI</span><div class="bar"><div style="width:40%" class="bar-agi"></div></div></div>
            </div>
            <div class="class-skills"><span>Golpe Sagrado</span><span>Luz Divina</span><span>Castigo Celestial</span></div>
        </div>
        <div class="class-card" onclick="AUDIO.select(); selectClass('nigromante')" data-class="nigromante">
            <div class="class-art">ğŸ’€</div><div class="class-glow nigromante-glow"></div>
            <h3>Nigromante</h3><p class="class-desc">SeÃ±or de la muerte. Drena vida y convoca aliados del mÃ¡s allÃ¡.</p>
            <div class="class-stats">
                <div class="stat-bar"><span>VID</span><div class="bar"><div style="width:48%" class="bar-hp"></div></div></div>
                <div class="stat-bar"><span>FUE</span><div class="bar"><div style="width:32%" class="bar-str"></div></div></div>
                <div class="stat-bar"><span>MAG</span><div class="bar"><div style="width:98%" class="bar-mag"></div></div></div>
                <div class="stat-bar"><span>AGI</span><div class="bar"><div style="width:55%" class="bar-agi"></div></div></div>
            </div>
            <div class="class-skills"><span>Drenar Vida</span><span>Plaga Oscura</span><span>EjÃ©rcito Muerto</span></div>
        </div>
        <div class="class-card" onclick="AUDIO.select(); selectClass('asesino')" data-class="asesino">
            <div class="class-art">ğŸ—¡ï¸</div><div class="class-glow asesino-glow"></div>
            <h3>Asesino</h3><p class="class-desc">Experto en sombras. Golpes crÃ­ticos devastadores con velocidad letal.</p>
            <div class="class-stats">
                <div class="stat-bar"><span>VID</span><div class="bar"><div style="width:52%" class="bar-hp"></div></div></div>
                <div class="stat-bar"><span>FUE</span><div class="bar"><div style="width:92%" class="bar-str"></div></div></div>
                <div class="stat-bar"><span>MAG</span><div class="bar"><div style="width:32%" class="bar-mag"></div></div></div>
                <div class="stat-bar"><span>AGI</span><div class="bar"><div style="width:92%" class="bar-agi"></div></div></div>
            </div>
            <div class="class-skills"><span>ApuÃ±alar</span><span>Golpe Letal</span><span>Sombra Mortal</span></div>
        </div>
    </div>
    <div class="select-confirm hidden" id="confirm-block">
        <button class="btn-confirm" onclick="AUDIO.select(); startGame()">âš” Comenzar Aventura âš”</button>
    </div>
</div>

<!-- MUNDO PRINCIPAL -->
<div id="game-world" class="hidden">
    <div class="hud-top">
        <div class="hud-hero-info">
            <div class="hud-avatar" id="hud-avatar">ğŸ›¡ï¸</div>
            <div class="hud-stats">
                <div class="hud-name" id="hud-name">HÃ©roe</div>
                <div class="hud-level">Nivel <span id="hud-level">1</span> | <span id="hud-class">Guerrero</span></div>
                <div class="hud-bars">
                    <div class="hud-bar-row"><span class="bar-label hp-label">â¤</span><div class="hud-bar-bg"><div class="hud-bar-fill hp-fill" id="hp-bar"></div></div><span class="bar-val" id="hp-val">100/100</span></div>
                    <div class="hud-bar-row"><span class="bar-label mp-label">âœ¦</span><div class="hud-bar-bg"><div class="hud-bar-fill mp-fill" id="mp-bar"></div></div><span class="bar-val" id="mp-val">50/50</span></div>
                    <div class="hud-bar-row"><span class="bar-label xp-label">â˜…</span><div class="hud-bar-bg"><div class="hud-bar-fill xp-fill" id="xp-bar"></div></div><span class="bar-val" id="xp-val">0/100</span></div>
                </div>
            </div>
        </div>
        <!-- Icono de oro: div CSS puro, funciona en todos los navegadores/SO -->
        <div class="hud-gold"><span class="gold-coin"></span><span id="gold-val">0</span> oro</div>
        <div class="hud-actions">
            <button class="hud-btn" onclick="AUDIO.click(); showScreen('inventory'); renderInventory()">
                <span class="btn-full">ğŸ’ Inventario</span><span class="btn-short">ğŸ’</span>
            </button>
            <button class="hud-btn btn-save" onclick="AUDIO.click(); saveGame()">
                <span class="btn-full">ğŸ’¾ Guardar</span><span class="btn-short">ğŸ’¾</span>
            </button>
        </div>
    </div>

    <div class="world-map">
        <div class="map-title">ğŸ—º El Reino de Valdoria</div>
        <div class="map-container">
            <div class="map-bg"></div>
            <!-- Nv.1 - Aldea (siempre visible) -->
            <div class="region region-village active-region" onclick="AUDIO.click(); enterZone('aldea')" style="top:65%;left:48%">
                <div class="region-icon">ğŸ˜ï¸</div>
                <div class="region-name">Aldea de Comienzo</div>
                <div class="region-level">Nv. 1</div>
            </div>
            <!-- Nv.2 - Bosque -->
            <div class="region" onclick="AUDIO.click(); enterZone('bosque')" style="top:52%;left:24%" id="zone-bosque">
                <div class="region-icon">ğŸŒ²</div>
                <div class="region-name">Bosque Oscuro</div>
                <div class="region-level">Nv. 2</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.3 - Catacumbas (NUEVA) -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('catacumbas')" style="top:55%;left:70%" id="zone-catacumbas">
                <div class="region-icon">ğŸ›</div>
                <div class="region-name">Catacumbas</div>
                <div class="region-level">Nv. 3</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.4 - Minas -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('minas')" style="top:38%;left:62%" id="zone-minas">
                <div class="region-icon">â›ï¸</div>
                <div class="region-name">Minas Malditas</div>
                <div class="region-level">Nv. 4</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.7 - Castillo -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('castillo')" style="top:25%;left:42%" id="zone-castillo">
                <div class="region-icon">ğŸ°</div>
                <div class="region-name">Castillo del Rey</div>
                <div class="region-level">Nv. 7</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.8 - Torre del Mago (NUEVA) -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('torre_mago')" style="top:30%;left:72%" id="zone-torre-mago">
                <div class="region-icon">ğŸ—¼</div>
                <div class="region-name">Torre del Mago</div>
                <div class="region-level">Nv. 8</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.10 - VolcÃ¡n -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('volcan')" style="top:14%;left:22%" id="zone-volcan">
                <div class="region-icon">ğŸŒ‹</div>
                <div class="region-name">VolcÃ¡n Eterno</div>
                <div class="region-level">Nv. 10</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.15 - Abismo -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('abismo')" style="top:10%;left:58%" id="zone-abismo">
                <div class="region-icon">ğŸ•³ï¸</div>
                <div class="region-name">El Abismo Final</div>
                <div class="region-level">Nv. 15</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.5 - Pantanos -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('pantanos')" style="top:62%;left:28%" id="zone-pantanos">
                <div class="region-icon">ğŸŒ¿</div>
                <div class="region-name">Pantanos Malditos</div>
                <div class="region-level">Nv. 5</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.6 - Ruinas -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('ruinas')" style="top:40%;left:8%" id="zone-ruinas">
                <div class="region-icon">ğŸ›ï¸</div>
                <div class="region-name">Ruinas del Imperio</div>
                <div class="region-level">Nv. 6</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.9 - Tundra -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('tundra')" style="top:20%;left:54%" id="zone-tundra">
                <div class="region-icon">ğŸ”ï¸</div>
                <div class="region-name">Tundra Glacial</div>
                <div class="region-level">Nv. 9</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.12 - Desierto -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('desierto')" style="top:6%;left:36%" id="zone-desierto">
                <div class="region-icon">ğŸœï¸</div>
                <div class="region-name">Desierto de Cenizas</div>
                <div class="region-level">Nv. 12</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
            <!-- Nv.14 - Santuario -->
            <div class="region region-locked" onclick="AUDIO.click(); enterZone('santuario')" style="top:4%;left:76%" id="zone-santuario">
                <div class="region-icon">â›©ï¸</div>
                <div class="region-name">Santuario Prohibido</div>
                <div class="region-level">Nv. 14</div>
                <div class="lock-icon">ğŸ”’</div>
            </div>
        </div>
    </div>
    <div class="quest-panel">
        <h3>ğŸ“œ Misiones Activas</h3>
        <div id="quest-list"></div>
        <div class="quest-log-btn"><button class="btn-small" onclick="showQuestLog()">Ver todas</button></div>
    </div>
</div>

<!-- ZONA -->
<div id="zone-screen" class="hidden">
    <div class="zone-header">
        <button class="btn-back" onclick="AUDIO.click(); showScreen('game-world')">â† Mapa</button>
        <h2 id="zone-title">Zona</h2>
        <p id="zone-desc">DescripciÃ³n...</p>
    </div>
    <div class="zone-content">
        <div class="zone-illustration" id="zone-art">ğŸŒ²</div>
        <div class="zone-actions">
            <button class="zone-btn" onclick="AUDIO.battleStart(); startBattle()">âš” Explorar y Combatir</button>
            <button class="zone-btn" onclick="AUDIO.click(); showNPC()">ğŸ’¬ Hablar con NPC</button>
            <button class="zone-btn secondary" onclick="AUDIO.click(); showScreen('game-world')">ğŸ—º Volver al Mapa</button>
        </div>
        <div class="zone-enemies"><h4>Enemigos en esta zona:</h4><div id="zone-enemy-list"></div></div>
    </div>
</div>

<!-- COMBATE -->
<div id="battle-screen" class="hidden">
    <div class="battle-arena">
        <div class="battle-bg" id="battle-bg"></div>
        <div class="enemy-area">
            <div class="enemy-info">
                <div class="enemy-name" id="enemy-name">Enemigo</div>
                <div class="enemy-level-badge">Nv. <span id="enemy-level">1</span></div>
                <div class="enemy-hp-bar-container"><div class="enemy-hp-bar" id="enemy-hp-bar"></div></div>
                <div class="enemy-hp-text" id="enemy-hp-text">50/50</div>
            </div>
            <div class="enemy-sprite" id="enemy-sprite">ğŸº</div>
            <div class="battle-effects" id="battle-effects"></div>
        </div>
        <div class="battle-log" id="battle-log"><p class="log-entry">Â¡El combate comienza!</p></div>
        <div class="hero-area">
            <div class="hero-sprite" id="hero-sprite-battle">ğŸ›¡ï¸</div>
            <div class="hero-battle-info">
                <div class="hero-battle-name" id="hero-battle-name">HÃ©roe</div>
                <div class="hero-battle-bars">
                    <div class="battle-bar-row"><span>â¤ HP</span><div class="battle-bar-bg"><div class="battle-bar-fill hp-fill" id="battle-hp-bar"></div></div><span id="battle-hp-text">100/100</span></div>
                    <div class="battle-bar-row"><span>âœ¦ MP</span><div class="battle-bar-bg"><div class="battle-bar-fill mp-fill" id="battle-mp-bar"></div></div><span id="battle-mp-text">50/50</span></div>
                </div>
            </div>
        </div>
        <div class="battle-actions" id="battle-actions">
            <div class="action-row">
                <button class="action-btn attack-btn" onclick="battleAction('attack')"><span class="action-icon">âš”</span><span>Atacar</span></button>
                <button class="action-btn skill-btn"  onclick="AUDIO.click(); showSkills()"><span class="action-icon">âœ¨</span><span>Habilidades</span></button>
                <button class="action-btn item-btn"   onclick="AUDIO.click(); showBattleItems()"><span class="action-icon">ğŸ§ª</span><span>Objetos</span></button>
                <button class="action-btn flee-btn"   onclick="battleAction('flee')"><span class="action-icon">ğŸ’¨</span><span>Huir</span></button>
            </div>
            <div class="skill-menu hidden" id="skill-menu"><div id="skill-list"></div><button class="btn-small cancel-btn" onclick="AUDIO.click(); hideSkills()">â† Cancelar</button></div>
            <div class="item-menu hidden" id="battle-item-menu"><div id="battle-item-list"></div><button class="btn-small cancel-btn" onclick="AUDIO.click(); hideBattleItems()">â† Cancelar</button></div>
        </div>
    </div>
</div>

<!-- RESULTADO BATALLA -->
<div id="battle-result" class="hidden">
    <div class="result-panel">
        <div class="result-icon" id="result-icon">ğŸ†</div>
        <h2 id="result-title">Â¡Victoria!</h2>
        <p id="result-desc"></p>
        <div class="rewards" id="rewards-block"></div>
        <div id="level-up-block" class="hidden">
            <div class="level-up-banner">â­ Â¡SUBISTE DE NIVEL! â­</div>
            <p id="level-up-details"></p>
        </div>
        <button class="btn-confirm" onclick="AUDIO.click(); closeBattleResult()">Continuar</button>
    </div>
</div>

<!-- INVENTARIO -->
<div id="inventory" class="hidden screen-dark">
    <div class="screen-header">
        <button class="btn-back" onclick="AUDIO.click(); closeInventory()">â† Volver</button>
        <h2 class="screen-title">ğŸ’ Inventario</h2>
    </div>
    <div class="inventory-layout">
        <div class="hero-stats-panel">
            <h3 id="inv-hero-name">HÃ©roe</h3>
            <div class="inv-avatar" id="inv-avatar">ğŸ›¡ï¸</div>
            <div class="stats-list" id="stats-list"></div>
        </div>
        <div class="items-panel"><h3>Objetos</h3><div class="items-grid" id="items-grid"></div></div>
        <div class="equipment-panel">
            <h3>Equipado</h3>
            <div class="equip-slots">
                <div class="equip-slot">âš” Arma: <span id="eq-weapon">Ninguna</span></div>
                <div class="equip-slot">ğŸ›¡ Armadura: <span id="eq-armor">Ninguna</span></div>
                <div class="equip-slot">ğŸ’ Accesorio: <span id="eq-accessory">Ninguno</span></div>
            </div>
        </div>
    </div>
</div>

<!-- DIÃLOGO NPC -->
<div id="npc-dialog" class="hidden">
    <div class="dialog-box">
        <div class="dialog-portrait" id="dialog-portrait">ğŸ‘´</div>
        <div class="dialog-content">
            <div class="dialog-name" id="dialog-name">NPC</div>
            <div class="dialog-text" id="dialog-text"></div>
        </div>
        <div class="dialog-options" id="dialog-options"></div>
    </div>
</div>

<!-- CRÃ‰DITOS -->
<div id="credits" class="hidden screen-dark">
    <div class="credits-content">
        <button class="btn-back" onclick="AUDIO.click(); showScreen('main-menu')">â† Volver</button>
        <div class="credits-title">âœ¦ CrÃ©ditos âœ¦</div>
        <p>CrÃ³nicas del Reino Olvidado</p>
        <p>Un RPG por turnos de fantasÃ­a medieval</p>
        <p>Desarrollado con HTML5, CSS3 y JavaScript puro</p>
        <p>MÃºsica procedural generada con Web Audio API</p>
        <p>Guardado en LocalStorage â€” sin servidor</p>
        <p>Â© 2024 â€” Libre para todos âš”ï¸</p>
    </div>
</div>

<!-- NOTIFICACIÃ“N -->
<div class="notification hidden" id="notification"><span id="notification-text"></span></div>

<!-- PANEL DE AUDIO â€” arriba a la derecha, lejos de los botones de batalla -->
<div class="audio-panel" id="audio-panel">
    <button class="audio-toggle-btn" id="audio-toggle-btn" aria-label="Control de sonido">&#127925;</button>
    <div class="audio-controls hidden" id="audio-controls">
        <div class="audio-title">&#127925; Sonido</div>
        <div class="audio-row">
            <button class="audio-btn active" id="btn-music">ğŸ¶ MÃºsica</button>
            <button class="audio-btn active" id="btn-sfx">ğŸ”Š FX</button>
        </div>
        <div class="audio-slider-row">
            <span>ğŸ¶</span>
            <input type="range" min="0" max="100" value="70" class="audio-slider" id="slider-music">
        </div>
        <div class="audio-slider-row">
            <span>ğŸ”Š</span>
            <input type="range" min="0" max="100" value="70" class="audio-slider" id="slider-sfx">
        </div>
    </div>
</div>

<script src="js/audio.js"></script>
<script src="js/data.js"></script>
<script src="js/game.js"></script>
<script>
(function() {
    const toggleBtn = document.getElementById('audio-toggle-btn');
    const controls  = document.getElementById('audio-controls');
    const btnMusic  = document.getElementById('btn-music');
    const btnSFX    = document.getElementById('btn-sfx');
    const sliderM   = document.getElementById('slider-music');
    const sliderS   = document.getElementById('slider-sfx');

    function openPanel(e) {
        e.preventDefault();
        AUDIO.init(); AUDIO.resume(); AUDIO.click();
        controls.classList.toggle('hidden');
    }
    toggleBtn.addEventListener('click',    openPanel, { passive: false });
    toggleBtn.addEventListener('touchend', openPanel, { passive: false });

    function onMusicToggle(e) {
        e.preventDefault();
        const on = AUDIO.toggleMusic();
        btnMusic.classList.toggle('active', on);
        btnMusic.classList.toggle('muted', !on);
    }
    btnMusic.addEventListener('click',    onMusicToggle, { passive: false });
    btnMusic.addEventListener('touchend', onMusicToggle, { passive: false });

    function onSFXToggle(e) {
        e.preventDefault();
        const on = AUDIO.toggleSFX();
        btnSFX.classList.toggle('active', on);
        btnSFX.classList.toggle('muted', !on);
    }
    btnSFX.addEventListener('click',    onSFXToggle, { passive: false });
    btnSFX.addEventListener('touchend', onSFXToggle, { passive: false });

    sliderM.addEventListener('input', function() { AUDIO.init(); AUDIO.resume(); AUDIO.setMusicVolume(this.value / 100); });
    sliderS.addEventListener('input', function() { AUDIO.init(); AUDIO.resume(); AUDIO.setSFXVolume(this.value / 100); });

    document.addEventListener('touchstart', function(e) {
        const panel = document.getElementById('audio-panel');
        if (!panel.contains(e.target)) controls.classList.add('hidden');
    }, { passive: true });
})();
</script>
</body>
</html>
